<script src="../../lib/es6/es6-promise.min.js"></script>
<script src="../../lib/es6/es6-bind.js"></script>
<script src="../../lib/es6/es6-array.js"></script>
<script src="../../lib/es6/es6-object-assign.js"></script>
<script src="../../lib/es6/es6-fetch.js"></script>
<script src="../../lib/red5pro/red5pro-sdk.min.js"></script>
<script>
  (function(window) {
    var configuration = (function () {
      var conf = sessionStorage.getItem('r5proTestBed');
      try {
        return JSON.parse(conf);
      }
      catch (e) {
        console.error('Could not read testbed configuration from sessionstorage: ' + e.message);
      }
      return {}
    })();

    if (configuration.verboseLogging) {
      window.publisherLog = function (message) {
        console.log('[Red5ProRTMPPublisher:SWF] - ' + message);
      };
      window.subscriberLog = function (message) {
        console.log('[Red5ProRTMPSubscriber:SWF] - ' + message);
      };
    }

    if (configuration.authentication.enabled) {
      var node = document.createElement('div');
      node.classList.add('hint-block', 'auth-alert');
      var note = document.createElement('span');
      note.classList.add('strong');
      note.innerHTML = '*Authentication is Enabled*';
      var link = document.createElement('a');
      link.innerText = 'Click here to disable.';
      link.href= '../../index.html';
      link.classList.add('auth-link');
      node.appendChild(note);
      node.appendChild(link);
      var testBody = document.getElementById('back-link-container').nextElementSibling;
      testBody.parentNode.insertBefore(node, testBody);
    }

    // Handle all successful setup of subscribers here to forward on to other operations.
    window.handleSubscriberSetupGlobally = function (subscriber) {
      if (window.exposeSubscriberGlobally) {
        window.exposeSubscriberGlobally(subscriber);
      }
      if (subscriber.getType().toLowerCase() === 'rtc') {
        if (window.red5proMonitorGetStats) {
          var opt = subscriber.getOptions();
          window.red5proMonitorGetStats(opt.subscriptionId, opt.streamName, opt.mediaElementId, subscriber.getPeerConnection());
        }
      }
    };
    // Handle any teardown of successfully setup subscribers.
    window.handleSubscriberTeardownGlobally = function (subscriber) {
      if (window.red5proUnmonitorGetStats) {
        window.red5proUnmonitorGetStats(subscriber.getOptions().subscriptionId);
      }
    }

  })(this);
</script>
